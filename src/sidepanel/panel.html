<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>InspectorAI Panel</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 16px;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    h2 {
      margin: 0;
      font-size: 16px;
    }

    button {
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    button.secondary {
      background-color: #6c757d;
    }
    
    button.outline {
      background-color: transparent;
      border: 1px solid #ccc;
      color: #333;
    }
    
    .icon-btn {
        background-repeat: no-repeat;
        background-position: 6px center;
        background-size: 14px;
        padding-left: 26px;
    }

    /* Settings Button Style */
    #settingsBtn {
      background: none;
      color: #666;
      border: 1px solid #ccc;
      padding: 6px;
      margin-left: 8px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .query-area {
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      height: 60px;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
      font-size: 13px;
      resize: vertical;
    }

    #response-container {
      flex: 1;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 4px;
      padding: 12px;
      background: #f9f9f9;
      font-size: 14px;
      line-height: 1.5;
    }
    
    .loading {
      color: #666;
      font-style: italic;
    }
    
    pre {
      background: #eee;
      padding: 8px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .hidden {
      display: none !important;
    }
    
    .html-preview {
      font-size: 11px;
      color: #666;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      background: #f1f1f1;
      padding: 4px;
      border-radius: 4px;
    }

    /* Settings View Styles */
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
      font-size: 13px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 13px;
    }
    .status {
      margin-top: 8px;
      font-size: 12px;
      color: green;
      text-align: center;
      height: 16px;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h2>InspectorAI <small id="appVersion" style="font-weight: normal; font-size: 0.8em; color: #666;"></small></h2>
    <div>
      <button id="settingsBtn" title="Settings">⚙️</button>
    </div>
  </div>

  <!-- Main View -->
  <div id="main-view" style="display: flex; flex-direction: column; height: 100%;">
    <div style="margin-bottom: 12px; display: flex; gap: 8px; justify-content: flex-end;">
        <button id="copyHtmlBtn" class="outline icon-btn" title="Copy Cleaned HTML" style="display: none; background-image: url('/assets/copy.png');">HTML</button>
        <button id="pickBtn">Pick Element</button>
    </div>
    
    <div id="htmlPreview" class="html-preview">No element selected</div>
    
    <div class="query-area">
      <textarea id="queryInput" placeholder="Ask AI about this element..."></textarea>
    </div>

    <div class="controls">
      <button id="sendBtn" disabled>Ask AI</button>
      <button id="clearBtn" class="secondary">Clear</button>
      <button id="toggleRawBtn" class="outline">Raw</button>
    </div>

    <div id="response-container">
      <div id="markdown-output"></div>
      <pre id="raw-output" class="hidden"></pre>
    </div>
    
    <div style="margin-top: 8px; text-align: right;">
        <button id="copyResponseBtn" class="outline icon-btn" title="Copy Response" style="background-image: url('/assets/copy.png'); display: none;">Copy Response</button>
    </div>
  </div>

  <!-- Settings View (Hidden by default) -->
  <div id="settings-view" class="hidden">
    <h3 style="margin-top: 0; font-size: 14px; margin-bottom: 12px;">Settings</h3>
    <div class="form-group">
      <label for="provider">AI Provider</label>
      <select id="provider">
        <option value="google-ai-mode">Google AI Mode (Free/No Token)</option>
        <option value="openai">OpenAI</option>
        <option value="anthropic">Anthropic</option>
        <option value="gemini">Google Gemini</option>
        <option value="llama">Meta Llama</option>
        <option value="custom">Custom (OpenAI Compatible)</option>
      </select>
    </div>

    <div class="form-group" id="modelGroup">
      <label for="model">Model</label>
      <select id="model">
        <!-- Options populated dynamically -->
      </select>
    </div>

    <!-- Custom Provider Fields -->
    <div id="customFields" class="hidden">
      <div class="form-group">
        <label for="customBaseUrl">Base URL</label>
        <input type="text" id="customBaseUrl" placeholder="https://api.example.com/v1">
      </div>
      <div class="form-group">
        <label for="customModel">Model ID</label>
        <input type="text" id="customModel" placeholder="e.g. deepseek-coder">
      </div>
    </div>

    <div class="form-group" id="apiKeyGroup">
      <label for="apiKey">API Key</label>
      <input type="password" id="apiKey" placeholder="Enter API Key">
    </div>

    <div class="form-group">
      <label for="maxTokens">Max Tokens</label>
      <input type="number" id="maxTokens" value="2048" min="1" max="128000">
    </div>

    <button id="saveSettingsBtn">Save & Close</button>
    <button id="cancelSettingsBtn" class="secondary" style="margin-top: 8px;">Cancel</button>
    <button id="viewLogsBtn" class="outline" style="margin-top: 8px;">View Logs</button>
    <div id="status" class="status"></div>
  </div>

  <script src="../lib/marked.min.js"></script>
  <script type="module" src="panel.js"></script>
</body>
</html>
